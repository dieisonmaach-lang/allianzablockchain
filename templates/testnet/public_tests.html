<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testes P√∫blicos - Allianza Testnet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Bot√£o Voltar ao Dashboard Padronizado */
        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .btn-back:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-6">
            <a href="/" class="btn-back">
                <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
            </a>
        </div>

        <h1 class="text-4xl font-bold mb-2">üß™ Testes P√∫blicos</h1>
        <p class="text-gray-400 mb-8">Execute testes reais e veja os resultados em tempo real</p>

        <!-- Bot√£o Executar Todos -->
        <div class="bg-blue-900 p-6 rounded-lg mb-6">
            <button id="runAllTestsBtn" class="bg-blue-600 hover:bg-blue-700 px-8 py-4 rounded-lg font-semibold text-lg transition">
                <i class="fas fa-play mr-2"></i>Executar Todos os Testes
            </button>
            <p class="text-sm text-gray-300 mt-2">Execute os 5 testes principais e veja os resultados detalhados</p>
        </div>

        <!-- Testes Individuais -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">1. QRS-3 Signature</h3>
                <button onclick="runTest('qrs3')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm">
                    Executar
                </button>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">2. Interoperabilidade</h3>
                <button onclick="runTest('interoperability')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm">
                    Executar
                </button>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">3. Performance</h3>
                <button onclick="runTest('performance')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm">
                    Executar
                </button>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">4. Valida√ß√£o de Blocos</h3>
                <button onclick="runTest('block_validation')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm">
                    Executar
                </button>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">5. Seguran√ßa Qu√¢ntica</h3>
                <button onclick="runTest('quantum_security')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm">
                    Executar
                </button>
            </div>
        </div>

        <!-- Logs em Tempo Real -->
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
            <h2 class="text-2xl font-semibold mb-4">üìã Logs em Tempo Real</h2>
            <div id="logsContainer" class="bg-gray-900 p-4 rounded font-mono text-sm max-h-96 overflow-y-auto">
                <p class="text-gray-500">Aguardando execu√ß√£o de testes...</p>
            </div>
        </div>

        <!-- Resultados -->
        <div id="resultsContainer" class="hidden">
            <h2 class="text-2xl font-semibold mb-4">üìä Resultados</h2>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const container = document.getElementById('logsContainer');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': 'text-blue-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            };
            
            const logEntry = document.createElement('p');
            logEntry.className = colors[type] || 'text-gray-300';
            logEntry.textContent = `[${timestamp}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }

        function runTest(testName) {
            addLog(`Iniciando teste: ${testName}...`, 'info');
            
            fetch('/api/public-tests/run', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({test_name: testName})
            })
            .then(async r => {
                // Verificar se a resposta √© JSON
                const contentType = r.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await r.text();
                    throw new Error(`Resposta n√£o √© JSON. Status: ${r.status}. Resposta: ${text.substring(0, 200)}`);
                }
                return r.json();
            })
            .then(data => {
                if (data.success) {
                    addLog(`‚úÖ Teste ${testName} conclu√≠do!`, 'success');
                    displayResult(data);
                } else {
                    addLog(`‚ùå Erro: ${data.error || 'Erro desconhecido'}`, 'error');
                    displayResult(data);
                }
            })
            .catch(e => {
                addLog(`‚ùå Erro: ${e.message}`, 'error');
                console.error('Erro completo:', e);
            });
        }

        function runAllTests() {
            const btn = document.getElementById('runAllTestsBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Executando...';
            
            document.getElementById('logsContainer').innerHTML = '';
            addLog('üöÄ Iniciando todos os testes...', 'info');
            
            fetch('/api/public-tests/run', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({})
            })
            .then(async r => {
                // Verificar se a resposta √© JSON
                const contentType = r.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await r.text();
                    throw new Error(`Resposta n√£o √© JSON. Status: ${r.status}. Resposta: ${text.substring(0, 200)}`);
                }
                return r.json();
            })
            .then(data => {
                if (data.success) {
                    addLog(`‚úÖ Todos os testes conclu√≠dos! Taxa de sucesso: ${data.success_rate_percent || 0}%`, 'success');
                    displaySummary(data);
                } else {
                    addLog(`‚ùå Alguns testes falharam: ${data.error || 'Erro desconhecido'}`, 'error');
                    if (data) displaySummary(data);
                }
            })
            .catch(e => {
                addLog(`‚ùå Erro: ${e.message}`, 'error');
                console.error('Erro completo:', e);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-play mr-2"></i>Executar Todos os Testes';
            });
        }

        function displayResult(result) {
            const container = document.getElementById('resultsContent');
            container.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4">${result.test_name}</h3>
                    <pre class="bg-gray-900 p-4 rounded text-sm overflow-x-auto">${JSON.stringify(result.results, null, 2)}</pre>
                </div>
            `;
            document.getElementById('resultsContainer').classList.remove('hidden');
        }

        function displaySummary(summary) {
            const container = document.getElementById('resultsContent');
            let html = `
                <div class="bg-gray-800 p-6 rounded-lg mb-4">
                    <h3 class="text-xl font-semibold mb-4">Resumo Geral</h3>
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="bg-gray-700 p-4 rounded">
                            <p class="text-sm text-gray-400">Taxa de Sucesso</p>
                            <p class="text-3xl font-bold text-green-400">${summary.success_rate_percent}%</p>
                        </div>
                        <div class="bg-gray-700 p-4 rounded">
                            <p class="text-sm text-gray-400">Testes Passaram</p>
                            <p class="text-3xl font-bold text-blue-400">${summary.successful_tests}/${summary.total_tests}</p>
                        </div>
                        <div class="bg-gray-700 p-4 rounded">
                            <p class="text-sm text-gray-400">Tempo Total</p>
                            <p class="text-3xl font-bold text-purple-400">${(summary.total_time_ms/1000).toFixed(2)}s</p>
                        </div>
                    </div>
                </div>
            `;
            
            summary.tests.forEach(test => {
                html += `
                    <div class="bg-gray-800 p-4 rounded-lg mb-2">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold">${test.test_name}</h4>
                            <span class="px-3 py-1 rounded ${test.success ? 'bg-green-600' : 'bg-red-600'}">
                                ${test.success ? '‚úÖ' : '‚ùå'}
                            </span>
                        </div>
                        <pre class="bg-gray-900 p-3 rounded text-xs overflow-x-auto">${JSON.stringify(test.results, null, 2)}</pre>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('resultsContainer').classList.remove('hidden');
        }

        document.getElementById('runAllTestsBtn').addEventListener('click', runAllTests);
    </script>
</body>
</html>




